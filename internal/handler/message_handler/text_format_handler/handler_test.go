package text_format_handler_test

import (
	"testing"

	"github.com/aatumaykin/go-obsidian-bot/internal/entity"
	"github.com/aatumaykin/go-obsidian-bot/internal/handler/message_handler/text_format_handler"
	tgbotapi "github.com/go-telegram-bot-api/telegram-bot-api/v5"
	"github.com/stretchr/testify/assert"
)

func TestHandler_Handle(t *testing.T) {
	tests := []struct {
		name     string
		text     string
		expected string
	}{
		{
			name: "Text 1",
			text: `**Oatmeal**

Oatmeal - —ç—Ç–æ —á–∞—Ç-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Å —Ç–µ—Ä–º–∏–Ω–∞–ª—å–Ω—ã–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–º[,](https://t.me/open_source_friend) –∫–æ—Ç–æ—Ä–æ–µ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤—É–µ—Ç —Å –±–æ–ª—å—à–∏–º–∏ —è–∑—ã–∫–æ–≤—ã–º–∏ –º–æ–¥–µ–ª—è–º–∏ (LLM)[,](https://t.me/open_source_friend) –∏—Å–ø–æ–ª—å–∑—É—è —Ä–∞–∑–ª–∏—á–Ω—ã–µ –±—ç–∫–µ–Ω–¥—ã –º–æ–¥–µ–ª–µ–π[.](https://t.me/open_source_friend)

‚òùüèª–û–Ω –º–æ–∂–µ—Ç –±—ã—Ç—å –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω —Å —Ç–∞–∫–∏–º–∏ —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞–º–∏[,](https://t.me/open_source_friend) –∫–∞–∫ Neovim[.](https://t.me/open_source_friend)

Oatmeal –ø–æ–∑–≤–æ–ª—è–µ—Ç –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é —Å –ø–æ–º–æ—â—å—é –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –∫–æ–º–∞–Ω–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–∏ –∏–ª–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è[,](https://t.me/open_source_friend) –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Å–ª—ç—à-–∫–æ–º–∞–Ω–¥—ã –∏ –ø—É–∑—ã—Ä—å–∫–∏ —á–∞—Ç–∞[.](https://t.me/open_source_friend)

–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –ø–æ–¥—Å–≤–µ—Ç–∫—É —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–∞ –∫–æ–¥–∞ —Å —Ä–∞–∑–ª–∏—á–Ω—ã–º–∏ —Ç–µ–º–∞–º–∏[.](https://t.me/open_source_friend)

–í—Å–µ —Å–µ–∞–Ω—Å—ã —á–∞—Ç–∞ —Å –º–æ–¥–µ–ª—è–º–∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è[,](https://t.me/open_source_friend) —á—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º –ø—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å –∏–ª–∏ –ø—Ä–æ–¥–æ–ª–∂–∞—Ç—å –ø—Ä–µ–¥—ã–¥—É—â–∏–µ —Ä–∞–∑–≥–æ–≤–æ—Ä—ã[.](https://t.me/open_source_friend)

https://github.com/dustinblackman/oatmeal

Site: https://dustinblackman.com/posts/oatmeal/`,
			expected: `**Oatmeal**

Oatmeal - —ç—Ç–æ —á–∞—Ç-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Å —Ç–µ—Ä–º–∏–Ω–∞–ª—å–Ω—ã–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–º[,](https://t.me/open_source_friend) –∫–æ—Ç–æ—Ä–æ–µ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤—É–µ—Ç —Å –±–æ–ª—å—à–∏–º–∏ —è–∑—ã–∫–æ–≤—ã–º–∏ –º–æ–¥–µ–ª—è–º–∏ (LLM)[,](https://t.me/open_source_friend) –∏—Å–ø–æ–ª—å–∑—É—è —Ä–∞–∑–ª–∏—á–Ω—ã–µ –±—ç–∫–µ–Ω–¥—ã –º–æ–¥–µ–ª–µ–π[.](https://t.me/open_source_friend)

‚òùüèª–û–Ω –º–æ–∂–µ—Ç –±—ã—Ç—å –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω —Å —Ç–∞–∫–∏–º–∏ —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞–º–∏[,](https://t.me/open_source_friend) –∫–∞–∫ Neovim[.](https://t.me/open_source_friend)

Oatmeal –ø–æ–∑–≤–æ–ª—è–µ—Ç –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é —Å –ø–æ–º–æ—â—å—é –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –∫–æ–º–∞–Ω–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–∏ –∏–ª–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è[,](https://t.me/open_source_friend) –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Å–ª—ç—à-–∫–æ–º–∞–Ω–¥—ã –∏ –ø—É–∑—ã—Ä—å–∫–∏ —á–∞—Ç–∞[.](https://t.me/open_source_friend)

–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –ø–æ–¥—Å–≤–µ—Ç–∫—É —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–∞ –∫–æ–¥–∞ —Å —Ä–∞–∑–ª–∏—á–Ω—ã–º–∏ —Ç–µ–º–∞–º–∏[.](https://t.me/open_source_friend)

–í—Å–µ —Å–µ–∞–Ω—Å—ã —á–∞—Ç–∞ —Å –º–æ–¥–µ–ª—è–º–∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è[,](https://t.me/open_source_friend) —á—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º –ø—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å –∏–ª–∏ –ø—Ä–æ–¥–æ–ª–∂–∞—Ç—å –ø—Ä–µ–¥—ã–¥—É—â–∏–µ —Ä–∞–∑–≥–æ–≤–æ—Ä—ã[.](https://t.me/open_source_friend)

https://github.com/dustinblackman/oatmeal

Site: https://dustinblackman.com/posts/oatmeal/

`,
		},
		{
			name: "Text 2",
			text: `**Oatmeal**

Oatmeal - —ç—Ç–æ —á–∞—Ç-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Å —Ç–µ—Ä–º–∏–Ω–∞–ª—å–Ω—ã–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–º, –∫–æ—Ç–æ—Ä–æ–µ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤—É–µ—Ç —Å –±–æ–ª—å—à–∏–º–∏ —è–∑—ã–∫–æ–≤—ã–º–∏ –º–æ–¥–µ–ª—è–º–∏ (LLM), –∏—Å–ø–æ–ª—å–∑—É—è —Ä–∞–∑–ª–∏—á–Ω—ã–µ –±—ç–∫–µ–Ω–¥—ã –º–æ–¥–µ–ª–µ–π.

‚òùüèª–û–Ω –º–æ–∂–µ—Ç –±—ã—Ç—å –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω —Å —Ç–∞–∫–∏–º–∏ —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞–º–∏, –∫–∞–∫ Neovim.

Oatmeal –ø–æ–∑–≤–æ–ª—è–µ—Ç –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é —Å –ø–æ–º–æ—â—å—é –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –∫–æ–º–∞–Ω–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–∏ –∏–ª–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è, –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Å–ª—ç—à-–∫–æ–º–∞–Ω–¥—ã –∏ –ø—É–∑—ã—Ä—å–∫–∏ —á–∞—Ç–∞.

–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –ø–æ–¥—Å–≤–µ—Ç–∫—É —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–∞ –∫–æ–¥–∞ —Å —Ä–∞–∑–ª–∏—á–Ω—ã–º–∏ —Ç–µ–º–∞–º–∏.

–í—Å–µ —Å–µ–∞–Ω—Å—ã —á–∞—Ç–∞ —Å –º–æ–¥–µ–ª—è–º–∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è, —á—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º –ø—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å –∏–ª–∏ –ø—Ä–æ–¥–æ–ª–∂–∞—Ç—å –ø—Ä–µ–¥—ã–¥—É—â–∏–µ —Ä–∞–∑–≥–æ–≤–æ—Ä—ã.

https://github.com/dustinblackman/oatmeal

Site: https://dustinblackman.com/posts/oatmeal/`,
			expected: `**Oatmeal**

Oatmeal - —ç—Ç–æ —á–∞—Ç-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Å —Ç–µ—Ä–º–∏–Ω–∞–ª—å–Ω—ã–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–º, –∫–æ—Ç–æ—Ä–æ–µ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤—É–µ—Ç —Å –±–æ–ª—å—à–∏–º–∏ —è–∑—ã–∫–æ–≤—ã–º–∏ –º–æ–¥–µ–ª—è–º–∏ (LLM), –∏—Å–ø–æ–ª—å–∑—É—è —Ä–∞–∑–ª–∏—á–Ω—ã–µ –±—ç–∫–µ–Ω–¥—ã –º–æ–¥–µ–ª–µ–π.

‚òùüèª–û–Ω –º–æ–∂–µ—Ç –±—ã—Ç—å –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω —Å —Ç–∞–∫–∏–º–∏ —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞–º–∏, –∫–∞–∫ Neovim.

Oatmeal –ø–æ–∑–≤–æ–ª—è–µ—Ç –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é —Å –ø–æ–º–æ—â—å—é –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –∫–æ–º–∞–Ω–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–∏ –∏–ª–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è, –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Å–ª—ç—à-–∫–æ–º–∞–Ω–¥—ã –∏ –ø—É–∑—ã—Ä—å–∫–∏ —á–∞—Ç–∞.

–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –ø–æ–¥—Å–≤–µ—Ç–∫—É —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–∞ –∫–æ–¥–∞ —Å —Ä–∞–∑–ª–∏—á–Ω—ã–º–∏ —Ç–µ–º–∞–º–∏.

–í—Å–µ —Å–µ–∞–Ω—Å—ã —á–∞—Ç–∞ —Å –º–æ–¥–µ–ª—è–º–∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è, —á—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º –ø—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å –∏–ª–∏ –ø—Ä–æ–¥–æ–ª–∂–∞—Ç—å –ø—Ä–µ–¥—ã–¥—É—â–∏–µ —Ä–∞–∑–≥–æ–≤–æ—Ä—ã.

https://github.com/dustinblackman/oatmeal

Site: https://dustinblackman.com/posts/oatmeal/

`,
		},
	}
	for _, tt := range tests {
		t.Run(tt.name, func(t *testing.T) {
			h := &text_format_handler.Handler{}

			note := entity.Note{
				Text: tt.text,
			}

			n, err := h.Handle(note, tgbotapi.Message{})
			assert.NoError(t, err)
			assert.Equal(t, tt.expected, n.Text)
		})
	}
}
